NOTE:,Detailed test cases for the MAGE-TAB functionality in the listed items will be added once all these scenarios have been tested.,Author: Leonie Misquitta                  Date: 11/12/2008
Gforge_id,Summary,TESTCASES - High level scenarios
13774,Experimental Factor duplicated when data files plus MAGE-TAB are imported in batches.,"1. Import 3 sets of MAGE-TAB -idf, sdrf, datafiles (use real data like Rembrandt) 2. Edit idf  experimental factor ""disease state"" with value ""tumorType"". 3. Modify one set to have a different ""disease state"" example ""tumortype_lm"".  4. Import 2 sets with the identical disease state - EXpected result: Only one experimental factor is listed eg: tumortype (ie- no duplication). 5. Import 3rd set with different ""disease state"" - Expected result - Second experimental factor added to the list."
,,
16411,Incremental bulk-update of biomaterial characteristics.,1. Import MAGE-tab set - should import successfully. 2. Modify sdrf to have different characteristics. 3. Prerequisites: a. modify sdrf file and keep track of changes made. B. modify idf file and add new value for modified sdrf filename. C. IMP: remember to rename both the idf and sdrf files.
,,4. Import sdrf with same name - Import should fail 5. Import sdrf with different name - Import should fail with message idf file required.  6. Import modified  sdrf +idf files - Import should be successful.
,,7. Check characteristics modified in the UI/Experiment - should be replaced with new values where ever modified. 8. Add blank values for characteristics. Import modified idf/sdrf files - Import should be successful. Check UI for behavior. 9. Modify Term source refs. Import modified idf/sdrf files - Import should be successful. Check UI for behavior. 10. Change measuremenet characteristics (unit values/changes). Import modified idf/sdrf files - Import should be successful. Check UI for behavior. 11. Add New characteristics columns/values. Import modified idf/sdrf files - Import should be successful. Check UI for behavior. 12. Add new datafile (Array data file). Import modified idf/sdrf files - Import should be successful. Check source/sample for links to the new datafile. 13. Change/add material types (labels). Import modified idf/sdrf files - Import should be successful. Check UI for behavior. 14. IDF - Import original and modified versions. Import should be successful. Check UI for behavior. Should work as default imports for idf works - there are no changes in logic/code for this import.
,,
16421,Term Source REFs following blank characteristics not handled correctly in MAGE-TAB import.,"1. Prerequisite - use a dataset like Rembrandt. 2. Create at least 2 sets of data (idf, sdrf, dataset), with variable values for characteristics and term source ref fields."
,,"a. sdrf1 has characteristic (eg:disease state) empty value, followed by term source ref with value (eg:MO), followed by characteristic (eg:tumor state) empty value - Expected result -correct values added to the fields ie. Variable read correctly. Failure ifa java lang nullpointer excetion encountered. "
,,"B. sdrf1 has characteristic (eg:disease state) with value (eg:tumortype), followed by term source ref with value (eg:MO), followed by characteristic (eg:tumor state) empty value - Expected result -correct values added to the fields ie. Variable read correctly. Failure ifa java lang nullpointer excetion encountered. "
,,"C. sdrf1 has characteristic (eg:disease state) with empty value, followed by term source ref with empty value, followed by characteristic (eg:tumor state) with value - Expected result -correct values added to the fields ie. Variable read correctly. Failure if a java lang nullpointer excetion encountered. "
,,D. Modify the sdrf to have the experimental factor characteristic with a blank value. Check UI for behavior.
,,
16573,Incremental bulk-update of biomaterial-data chains using MAGE-TAB,Prerequisite: See import expermental data use case. Gforge #16406 that ensures that Sample names (and other biomaterial names) in an experiment are unique.  Importing a new MAGE-TAB set where the SDRF references biomaterial names that already exist in the system must result in appropriate modification of the biomaterial-data chains. The common use case is from TCGA where they first import an SDRF associating Sample 1 to Extracts 1-10 and then later import a new SDRF associating the same Sample 1 to new Extracts 11-20. 2. Create at least 4 modified sdrf's for the scenarios described a-d.
,,"A. Old SDRF links Source A to Extract 1 and Extract 2. System auto-generates Sample A in between. New SDRF links Source A to Extract 3 and Extract 4. Expected results: System reuses generated Sample A, and resulting chain looks like this: Source A linked to Sample A linked to Extracts 1, 2, 3 and 4."
,,"B. Old SDRF links Source A to Extract 1 and Extract 2. System auto-generates Sample A in between. New SDRF links the same Extracts 1 and 2 to a new Source B. Expected results: System generates Sample B, and resulting chains look like this: Source A linked to Sample A linked to Extracts 1 and 2; Source B linked to Sample B linked to Extracts 1 and 2."
,,"C. Old SDRF links Source A to Extract 1 and Extract 2. System auto-generates Sample A in between. New SDRF links Source A and Source B to a new Extract 3. Expected results: System reuses previously-auto-generated Sample A, auto-generates Sample B, and the resulting chains look like this: Source A linked to Sample A linked to Extracts 1, 2 and 3; Source B linked to Sample B linked to Extract 3."
,,"D. Old SDRF links Source A to Extract 1 and Extract 2. System auto-generates Sample A in between. New SDRF links Source A and Source B to existing Extract 2. Expected results: System auto-generates Sample B, and resulting chains look like this: Source A linked to Sample A linked to Extracts 1 and 2; Source B linked to Sample B linked to Extract 2."
,,"NOTE: Tests E, F, G - tests that Gforge #16411, 16421 and 16573 functionality work simultaneously."
,,E. Import sdrf with modified characteristics (both reference and measurement values) and new data files.  Test : biomaterial data chains should be maintained.
,,F. Import sdrf with modified characteristics (both reference and measurement values) and new samples (one to many). Test: biomaterial data chains should be maintained.
,,G. Follow scenarios A-D but with sample information added in the sdrf (not autogenerated). Test: biomaterial data chains should be maintained.
,,
16627,Provide MAGE-TAB export of an experiment,"1. Allow the ability to export a MAGE-TAB document set (IDF and SDRF)
containing the biomaterial-data chains and annotations in an experiment. Download page now has a button that allows you to export the consolidated MAGE-TAB for an experiment.
The downloaded zip will contain an IDF and SDRF. The IDF will contain the title, description, Term Source details and a pointer to the SDRF. The SDRF will contain the biomaterial-data chains, biomaterial characteristics - both term-based and measurement with unit. It will also contain the source Provider and labeled extract Label columns. The exported data will be restricted by the usual access control rules."
,,A. Import a MAGE-TAB set. Export the set using the download button. A.zip file should be generated.  Open the .zip file and check the idf and sdrf file formats. 
,,"B. Examples: In the IDF fields not populated: Term Source File. Interpretation-this is a bug- In MageTabExporterBean.java, the getSdrfTermSource() method populates the name and version for the sdrfTermSource, but doesn't populate the ""file"" (URL). C. In the SDRF, the field Characteristics[TumorGrading]has control characters "" -&gt;"" or a possible filler. Interpretation- this is a bug- As part of our response to the security scan, we encoded the MAGE-TAB empty symbol from -> to -&gt; (See SdrfDocument.java). While exporting, we should decode it back to -> and write that to the sdrf file."
,,D. Import multiple MAGE-TAB sets to the same experiment. Export the set using the download button. A.zip file should be generated.  Open the .zip file and check the idf and sdrf file formats.  See example B and C for formats.
,,E. Import sdrf file which has a blank in the characteristics instead of a null value ->. Export this set and check format has no decoding issues.
,,F.  Import sdrf with modified  characteristics (both reference and measurement values). Export this set - new files should contain the correct modified values.
,,G. Import modified sdrf with one to many and many to one variations (eg: 1 source referenced by many samples and so on). Export this set - new files should contain the correct modified values.
,,H. Change permissions. Log in as user with restricted access. Export mage-tab set. Files should contain only those samples which the user has access to. All sources should be present in the exported files.
,,"**I. Export mage-tab set. Modify the exported files for characteristics and source refs. Import files (idf, sdrf) - Modified characteristic values should be changed while the non-modified values should be unchanged. Check for duplication.  This scenario will be moved later to its own test case."
,,
17119,Pre-2.1.0 data on PROD must be scrubbed to correct derived-raw data relationships.,"Fix: IMP: The SQL script to scrub data (i.e associating raw and derived data) must be run on caArray Production prior to release of caArray2.2.0. The script must also be provided to any local installers, with instructions on what the script does and its implications. The local installers will have the choice to run the script or not. Prerequisite: Gforge implementation item 13010 addressed the issue of derived data not being associated correctly with the corresponding raw data. However, as part of that issue, existing data on caArray Production was not scrubbed. This means that experiments that were imported before the 13010 fix still have incorrect relationships between raw and derived data. This includes some high profile experiments like GSK and Rembrandt."
,,"1. One major implication of this incorrect data is that the MAGE-TAB export feature (16627) results in an SDRF with duplicate rows, one with the raw data file and the second with the derived data file. The data on caArray Production that was imported before 2.1.0 must be scrubbed to represent the right relationship between raw and derived data. This involves looking at the original MAGE-TAB file set/sets that were used to import the data in order to figure out which raw data files should be associated to which derived data files."
,,"2. Prior to 2.1.0, hybridizations were not allowed to have multiple raw data files. So the pre-2.1.0 data that needs to be scrubbed can be assumed to have zero or one raw array data file per hybridization. Our solution will be to look for hybridizations that: 1. have exactly one raw data file; and 2. have one or more derived data files; and 3. one or more of those derived data files are unassociated to any raw data file. For each such derived data file, we will add the raw data file to its ""derived_from"" set. The script is available at software/caarraydb/src/main/sql/migration/defect-17119.sql."
,,3. Testing: Look in the database before and after running the script to make sure it worked. (The raw-derived relationships are not obvious anywhere in the UI.) Some example experiments that have this problem are the Rembrandt gene expression experiment (id=37) and the GSK Transcript Profiling experiment (id=41). Run the select statement of the script. 
,,4. Testing - the raw-derived association can be tested in the UI by exporting the MAGE-TAB set and checking the sdrf file for the raw and derived files associated to the same sources.
