<project name="caArray API Client Examples" default="test-clean">

    <property file="local.properties"/>
    
    <property name="hostname" value="array.nci.nih.gov" />
    <property name="jndi.port" value="8080" />
    <property name="grid.port" value="80" />

    <property name="java.src.dir" value="${basedir}/example/java/src" />
    <property name="java.classes.dir" value="${basedir}/example/java/classes" />
    <property name="java.lib.dir" value="${basedir}/lib/java" />
    <property name="grid.src.dir" value="${basedir}/example/grid/src" />
    <property name="grid.classes.dir" value="${basedir}/example/grid/classes" />
    <property name="grid.lib.dir" value="${basedir}/lib/grid" />

    <path id="java.api.classpath">
        <pathelement location="${java.classes.dir}" />
        <pathelement location="${basedir}/caarray-client-legacy.jar" />
        <fileset dir="${java.lib.dir}">
            <include name="*.jar" />
        </fileset>
    </path>

    <path id="grid.api.classpath">
        <pathelement location="${grid.classes.dir}" />
         <pathelement location="${basedir}/caarray-client-legacy.jar" />
         <fileset dir="${grid.lib.dir}">
             <include name="*.jar" />
         </fileset>
    </path>

    <target name="test-clean" depends="clean,test"
        description="Invokes both the Java and caGrid APIs of a caArray server. By default, connects to array.nci.nih.gov on grid port 80 and JNDI port 8080. To configure this to run against different hosts/ports, invoke ant with the following properties: -Dhostname=&lt;hostname&gt; -Djndi.port=&lt;JNDI port&gt; -Dgrid.port=&lt;grid service port&gt;" />

    <target name="clean">
        <delete dir="${java.classes.dir}" />
        <delete dir="${grid.classes.dir}" />
    </target>

    <target name="compile:java">
        <mkdir dir="${java.classes.dir}" />
        <javac srcdir="${java.src.dir}" destdir="${java.classes.dir}" classpathref="java.api.classpath" debug="true" />
    </target>

    <target name="compile:grid">
        <mkdir dir="${grid.classes.dir}" />
        <javac srcdir="${grid.src.dir}" destdir="${grid.classes.dir}" classpathref="grid.api.classpath" debug="true" />
    </target>

    <target name="test" depends="test:java-api,test:grid-api" />

    <target name="test:java-api" depends="compile:java">
        <java classname="gov.nih.nci.caarray.example.legacy.java.JavaApiExample" classpathref="java.api.classpath" failonerror="true" fork="true">
             <arg value="${hostname}" />
             <arg value="${jndi.port}" />
         </java>
    </target>

    <target name="test:grid-api" depends="compile:grid">
        <java classname="gov.nih.nci.caarray.example.legacy.grid.GridApiExample" classpathref="grid.api.classpath" failonerror="true" fork="true">
             <arg value="${hostname}" />
             <arg value="${grid.port}" />
         </java>
    </target>
</project>