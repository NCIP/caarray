<project name="test-build" default="all" basedir="." xmlns:au="antlib:org.apache.ant.antunit" xmlns="antlib:org.apache.tools.ant">

<!-- IMPORTANT: This file works with tightly coupled with remote-build.xml 
  and does not work indepently of it -->

<taskdef uri="antlib:org.apache.ant.antunit"
  resource="org/apache/ant/antunit/antlib.xml">
  <classpath>
    <pathelement location="${antunit.jar.location}"/>
  </classpath>
</taskdef>

  <condition property="isWindows">
    <and>
        <os family="windows"/>
		<not>
   		  <os family="win9x"/>
		</not>
    </and>
  </condition>

  <target name="setUp">
  </target>

  <target name="all" depends="display-properties,setUp,testSuite,tearDown" />

  <!-- is called after the test, even if that caused an error -->
  <target name="tearDown">
    
  </target>

  <target name="display-properties">
  	  <echo> Diagnostics...</echo>
	  <echoproperties/>
  </target>

  <target name="testSuite" depends="testEnvPropertyFile,testJavaSecureChannelFileExists, 
  testPropertiesFileExists,testSshKeyFileExists,testSvnLocalTrunk,testIsWindows,testBuildNoTest" />

  <target name="testEnvPropertyFile">
	<au:assertPropertySet name="envpropertyfile" message="Target environment file not found. 
	Please set target environment file with -Denvpropertyfile=[FULLY QUALIFIED PATH TO PROPERTY FILE]" />  
  </target>

  <target name="testBuildNoTest">
	<au:assertPropertySet name="notest" message="notest is a required system property. Please set this property using -Dnotest=true"/>  
  </target> 

  <target name="testSvnLocalTrunk">
	<au:assertPropertySet name="svn.local.trunk" message="svn.local.trunk property not set."/>  
  </target>

  <target name="testIsWindows">
	<au:assertPropertySet name="isWindows" message="Currently, remote-build.xml only runs on Windows."/>  
  </target>

  <target name="testUpdateEnvironmentProperties">
	<au:assertPropertySet name="svn.local.trunk" message="svn.local.trunk is a required property when calling the update-environment-properties target"/>  
	<au:assertPropertySet name="scm.private.repo" message="scm.private.repo is a required property when calling the update-environment-properties target"/>  
  </target>

  <target name="testPropertiesFileExists">
	<au:assertFileExists file="${envpropertyfile}" message="Unable to find the file: ${envpropertyfile}. The path to -Denvpropertyfile must be fully-qualified." />  
  </target>

  <target name="testSshKeyFileExists">
	<au:assertFileExists file="${ssh.key.file}" message="Unable to find the file: ${ssh.key.file}. Please update the value of the ssh.key.file attribute in the ${envpropertyfile} file." />  
  </target>

  <target name="testJavaSecureChannelFileExists">
	<au:assertFileExists file="${jsch.jar.location}" message="Unable to find the file: ${jsch.jar.location}." />  
  </target>

  <target name="testWebAppOnline">
    <property name="app.url" value="http://${jboss.server.hostname}:${jboss.server.port}/caarray/"/>
	<echo>Testing if ${app.url} is Offline...</echo>
	<condition property="offline">
	    <http url="${app.url}"/>
	</condition>
	<au:assertEquals message="Unable to reach ${app.url}" expected="true"
                      actual="${offline}" casesensitive="true"/>
    <echo>${app.url} is Online...</echo>
  </target>

</project>