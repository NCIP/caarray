<project name="macrodefs">

    <macrodef name="run-junit-tests">
        <attribute name="test.src.dir" />
        <attribute name="xml.output.dir" />
        <attribute name="classpath" default="" />
        <attribute name="instrumented.classes" default="" />

        <sequential>
            <mkdir dir="@{xml.output.dir}" />
            <junit printsummary="on" failureproperty="junit.failure" fork="true" forkmode="once" maxmemory="256m">
                <sysproperty key="net.sourceforge.cobertura.datafile"
                             file="${cobertura.file}" />
                <sysproperty key="server.hostname" value="${jboss.server.hostname}"/>
                <sysproperty key="server.port" value="${jboss.server.port}"/>
                <sysproperty key="server.jndi.port" value="${jboss.server.jndi.port}"/>
                <classpath>
                    <pathelement path="@{instrumented.classes}" />
                    <pathelement path="@{classpath}" />
                  <path refid="cobertura.classpath" />
                </classpath>
                <formatter type="xml" />
                <batchtest todir="@{xml.output.dir}">
                    <fileset dir="@{test.src.dir}">
                        <include name="**/*Test.java" />
                        <exclude name="**/Abstract*Test.java" />
                    </fileset>
                </batchtest>
            </junit>
        </sequential>
    </macrodef>

    <macrodef name="run-sql-script" description="By default this will use the database.url, to use drop database &amp; user use the database.system.url property">
        <attribute name="sql.file" />
        <attribute name="sql.delimiter" default=";" />
        <attribute name="sql.delimitertype" default="normal" />
        <attribute name="database.url" default="${database.url}" />
        <attribute name="database.user" default="${database.user}" />
        <attribute name="database.password" default="${database.password}" />
		<echoproperties/>
        <sequential>
            <sql driver="${database.driver}"
                 url="@{database.url}"
                 userid="@{database.user}"
                 password="@{database.password}"
                 src="@{sql.file}"
                 onerror="continue"
                 autocommit="true"
                 delimiter="@{sql.delimiter}"
                 delimitertype="@{sql.delimitertype}"
                 keepformat="true">
                <classpath>
                    <pathelement location="${mysql-connector.jar}"/>
                </classpath>
            </sql>
        </sequential>
    </macrodef>

</project>