<!-- *********************************************************************** -->
<!-- ** PROJECT:   caarray-cc-nightly                                     ** -->
<!-- *********************************************************************** -->

<project name="caarray-cc-nightly" default="nightly" basedir="..">

    <description>
	 This build script is used to invoke the normal build.xml via
	 the delegating-build.xml with the caveat that certain targets within the
	 build.xml need to overridden.
	    -->Why?
	 Certain targets responsible for lauching processes (start jboss)
	 need to use the psexec.exe process to launch the process because CC will block waiting for the process
	 that is started to complete which is not what we want.

	 Default target for this script is 'nightly' which is imported via build.xml
    </description>


    <import file="build/build.xml"/>

	<property name="psexec.exe.cmd" value="${basedir}/build/resources/cruisecontrol/windows/psexec.exe"/>

    <target name="deploy:start-jboss" depends="deploy:check-if-jboss-is-running" unless="jboss.running"
    	description="Override target defined in build.xml to start jboss using PSEXEC.exe">

		<echo message="psexec.exe.cmd=${psexec.exe.cmd}"/>
		<echo message="psexec.system.username=${psexec.system.username}" />
		<echo message="psexec.system.password=${psexec.system.password}" />
		<exec executable="${psexec.exe.cmd}" dir="${jboss.home}/bin">
		   <arg line="-u ${psexec.system.username} -p ${psexec.system.password} -d -i -w ${jboss.home}/bin/ ${jboss.home}/bin/run.bat" />
		</exec>
    </target>
</project>